<!DOCTYPE html>
<html lang="fa"
      dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>اتاق مشاوره امن - درخواست #1234</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazir', Tahoma, sans-serif;
            background: #1a1a1a;
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        /* لایه اصلی */
        .video-room {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* نوار بالایی */
        .room-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .room-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .room-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .room-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }

        .timer {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* منطقه ویدیو */
        .video-area {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 15px;
            padding: 15px;
        }

        .main-video-container {
            position: relative;
            background: #2a2a2a;
            border-radius: 15px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            text-align: center;
            color: #666;
        }

        .video-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .participant-info {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .participant-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .my-video-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .my-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* نوار کنترل */
        .control-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 50px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .control-btn.mute {
            background: #f44336;
            color: white;
        }

        .control-btn.active {
            background: #4caf50;
            color: white;
        }

        .control-btn.inactive {
            background: #666;
            color: #ccc;
        }

        .control-btn.end-call {
            background: #f44336;
            color: white;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        /* پنل جانبی */
        .side-panel {
            background: #2a2a2a;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-tabs {
            display: flex;
            background: #333;
        }

        .panel-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .panel-tab.active {
            background: #667eea;
            color: white;
        }

        .panel-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* چت */
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 10px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 5px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #333;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .message {
            margin-bottom: 15px;
        }

        .message.own {
            text-align: left;
        }

        .message-bubble {
            display: inline-block;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .message.own .message-bubble {
            background: #667eea;
            color: white;
        }

        .message.other .message-bubble {
            background: #444;
            color: white;
        }

        .message-info {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            background: #444;
            border: 1px solid #555;
            border-radius: 20px;
            color: white;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* انتقال فایل */
        .file-drop-zone {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .file-drop-zone:hover,
        .file-drop-zone.drag-over {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #444;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .file-icon {
            font-size: 1.5rem;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-size: 0.9rem;
            color: white;
        }

        .file-size {
            font-size: 0.8rem;
            color: #888;
        }

        .file-actions {
            display: flex;
            gap: 5px;
        }

        .file-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .download-btn {
            background: #4caf50;
            color: white;
        }

        .delete-btn {
            background: #f44336;
            color: white;
        }

        /* تنظیمات */
        .settings-group {
            margin-bottom: 25px;
        }

        .settings-group h4 {
            color: #ccc;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #444;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            color: white;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #666;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: #4caf50;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active::after {
            transform: translateX(-25px);
        }

        .quality-select {
            padding: 8px 12px;
            background: #444;
            border: 1px solid #555;
            border-radius: 5px;
            color: white;
        }

        /* مودال خروج */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #333;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-content h3 {
            color: white;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .video-area {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }

            .side-panel {
                height: 300px;
            }

            .my-video-container {
                width: 120px;
                height: 90px;
            }

            .control-bar {
                position: static;
                transform: none;
                margin: 10px auto;
            }
        }
    </style>
</head>

<body>
    <!-- نوار بالایی -->
    <div class="room-header">
        <div class="room-info">
            <h1 class="room-title">🔒 اتاق مشاوره امن - درخواست #1234</h1>
            <div class="room-status">
                <div class="status-dot"></div>
                <span>ارتباط امن برقرار</span>
            </div>
        </div>
        <div class="timer"
             id="callTimer">00:00:00</div>
        <div class="header-controls">
            <button class="header-btn"
                    onclick="toggleFullscreen()">🔳 تمام صفحه</button>
            <button class="header-btn"
                    onclick="showExitModal()">❌ خروج</button>
        </div>
    </div>

    <!-- منطقه ویدیو -->
    <div class="video-area">
        <!-- ویدیو اصلی -->
        <div class="main-video-container"
             id="mainVideoContainer">
            <div class="video-placeholder">
                <div class="video-placeholder-icon">👤</div>
                <h3>در انتظار اتصال مشاور...</h3>
                <p>دکتر علی محمدی</p>
            </div>

            <div class="participant-info"
                 style="display: none;"
                 id="participantInfo">
                <div class="participant-avatar">👨‍💼</div>
                <span>دکتر علی محمدی</span>
            </div>

            <!-- ویدیو خودم -->
            <div class="my-video-container">
                <video class="my-video"
                       id="myVideo"
                       autoplay
                       muted></video>
            </div>

            <!-- نوار کنترل -->
            <div class="control-bar">
                <button class="control-btn active"
                        id="micBtn"
                        onclick="toggleMic()">
                    🎤
                </button>
                <button class="control-btn active"
                        id="cameraBtn"
                        onclick="toggleCamera()">
                    📹
                </button>
                <button class="control-btn inactive"
                        id="screenBtn"
                        onclick="toggleScreen()">
                    🖥️
                </button>
                <button class="control-btn end-call"
                        onclick="showExitModal()">
                    📞
                </button>
                <button class="control-btn inactive"
                        id="recordBtn"
                        onclick="toggleRecord()">
                    ⏺️
                </button>
            </div>
        </div>

        <!-- پنل جانبی -->
        <div class="side-panel">
            <div class="panel-tabs">
                <button class="panel-tab active"
                        onclick="showPanel('chat')">💬 چت</button>
                <button class="panel-tab"
                        onclick="showPanel('files')">📁 فایل</button>
                <button class="panel-tab"
                        onclick="showPanel('settings')">⚙️ تنظیمات</button>
            </div>

            <!-- پنل چت -->
            <div class="panel-content"
                 id="chatPanel">
                <div class="chat-messages"
                     id="chatMessages">
                    <div class="message other">
                        <div class="message-bubble">
                            سلام، من آماده شروع مشاوره هستم. لطفاً مشکل خود را شرح دهید.
                        </div>
                        <div class="message-info">دکتر علی محمدی - 14:30</div>
                    </div>
                    <div class="message own">
                        <div class="message-bubble">
                            سلام دکتر، ممنون از وقتتان. مشکل من در مورد معماری نرم‌افزار است.
                        </div>
                        <div class="message-info">شما - 14:32</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text"
                           class="chat-input"
                           id="chatInput"
                           placeholder="پیام خود را بنویسید..."
                           onkeypress="handleChatEnter(event)">
                    <button class="send-btn"
                            onclick="sendMessage()">➤</button>
                </div>
            </div>

            <!-- پنل فایل -->
            <div class="panel-content"
                 id="filesPanel"
                 style="display: none;">
                <div class="file-drop-zone"
                     id="fileDropZone">
                    <div style="font-size: 2rem; margin-bottom: 10px;">📁</div>
                    <p>فایل را اینجا بکشید یا کلیک کنید</p>
                    <p style="font-size: 0.8rem; margin-top: 5px;">حداکثر 10MB</p>
                    <input type="file"
                           id="fileInput"
                           style="display: none;"
                           multiple>
                </div>

                <div class="file-list"
                     id="fileList">
                    <div class="file-item">
                        <div class="file-info">
                            <div class="file-icon">📄</div>
                            <div class="file-details">
                                <div class="file-name">نیازمندی_پروژه.pdf</div>
                                <div class="file-size">2.3 MB</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="file-btn download-btn">دانلود</button>
                        </div>
                    </div>
                    <div class="file-item">
                        <div class="file-info">
                            <div class="file-icon">🖼️</div>
                            <div class="file-details">
                                <div class="file-name">diagram.png</div>
                                <div class="file-size">1.8 MB</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="file-btn download-btn">دانلود</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- پنل تنظیمات -->
            <div class="panel-content"
                 id="settingsPanel"
                 style="display: none;">
                <div class="settings-group">
                    <h4>🔊 صدا و تصویر</h4>
                    <div class="setting-item">
                        <span class="setting-label">حذف نویز</span>
                        <div class="toggle-switch active"
                             onclick="toggleSetting(this)"></div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">کیفیت ویدیو</span>
                        <select class="quality-select">
                            <option value="720p">HD (720p)</option>
                            <option value="1080p"
                                    selected>Full HD (1080p)</option>
                            <option value="480p">SD (480p)</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h4>🔒 امنیت</h4>
                    <div class="setting-item">
                        <span class="setting-label">رمزنگاری end-to-end</span>
                        <div class="toggle-switch active"
                             onclick="toggleSetting(this)"></div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">ضبط خودکار</span>
                        <div class="toggle-switch"
                             onclick="toggleSetting(this)"></div>
                    </div>
                </div>

                <div class="settings-group">
                    <h4>📊 اطلاعات اتصال</h4>
                    <div
                         style="background: #444; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.85rem;">
                        <div>📡 کیفیت اتصال: عالی</div>
                        <div>⚡ تاخیر: 45ms</div>
                        <div>📈 پهنای باند: 2.5 Mbps</div>
                        <div>🔒 رمزنگاری: AES-256</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مودال خروج -->
    <div class="modal"
         id="exitModal">
        <div class="modal-content">
            <h3>خروج از جلسه</h3>
            <p style="color: #ccc; margin-bottom: 25px;">
                آیا مطمئن هستید که می‌خواهید از جلسه خارج شوید؟
            </p>
            <div class="modal-actions">
                <button class="modal-btn btn-danger"
                        onclick="endCall()">خروج</button>
                <button class="modal-btn btn-secondary"
                        onclick="closeModal()">ادامه</button>
            </div>
        </div>
    </div>

    <script>
        // متغیرهای سراسری
        let callStartTime = Date.now();
        let timerInterval;
        let micEnabled = true;
        let cameraEnabled = true;
        let screenSharing = false;
        let recording = false;

        // شروع تایمر
        function startTimer() {
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Date.now() - callStartTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);

            document.getElementById('callTimer').textContent =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // کنترل میکروفن
        function toggleMic() {
            micEnabled = !micEnabled;
            const btn = document.getElementById('micBtn');
            if (micEnabled) {
                btn.className = 'control-btn active';
                btn.innerHTML = '🎤';
            } else {
                btn.className = 'control-btn mute';
                btn.innerHTML = '🔇';
            }
        }

        // کنترل دوربین
        function toggleCamera() {
            cameraEnabled = !cameraEnabled;
            const btn = document.getElementById('cameraBtn');
            if (cameraEnabled) {
                btn.className = 'control-btn active';
                btn.innerHTML = '📹';
            } else {
                btn.className = 'control-btn inactive';
                btn.innerHTML = '📹';
            }
        }

        // اشتراک صفحه
        function toggleScreen() {
            screenSharing = !screenSharing;
            const btn = document.getElementById('screenBtn');
            if (screenSharing) {
                btn.className = 'control-btn active';
                btn.innerHTML = '🛑';
            } else {
                btn.className = 'control-btn inactive';
                btn.innerHTML = '🖥️';
            }
        }

        // ضبط جلسه
        function toggleRecord() {
            recording = !recording;
            const btn = document.getElementById('recordBtn');
            if (recording) {
                btn.className = 'control-btn active';
                btn.innerHTML = '⏹️';
            } else {
                btn.className = 'control-btn inactive';
                btn.innerHTML = '⏺️';
            }
        }

        // مدیریت پنل‌ها
        function showPanel(panelName) {
            // مخفی کردن همه پنل‌ها
            document.querySelectorAll('.panel-content').forEach(panel => {
                panel.style.display = 'none';
            });

            // حذف کلاس active از تب‌ها
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // نمایش پنل انتخابی
            const panels = {
                'chat': 'chatPanel',
                'files': 'filesPanel',
                'settings': 'settingsPanel'
            };

            document.getElementById(panels[panelName]).style.display = 'block';
            event.target.classList.add('active');
        }

        // ارسال پیام
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = 'message own';
                messageElement.innerHTML = `
 <div class="message-bubble">${message}</div>
 <div class="message-info">شما - ${new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' })}</div>
 `;

                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                input.value = '';
            }
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // مدیریت فایل
        document.getElementById('fileDropZone').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        function handleFileSelect(event) {
            const files = event.target.files;
            for (let file of files) {
                addFileToList(file);
            }
        }

        function addFileToList(file) {
            const fileList = document.getElementById('fileList');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';

            const fileIcon = getFileIcon(file.type);
            const fileSize = formatFileSize(file.size);

            fileItem.innerHTML = `
 <div class="file-info">
 <div class="file-icon">${fileIcon}</div>
 <div class="file-details">
 <div class="file-name">${file.name}</div>
 <div class="file-size">${fileSize}</div>
 </div>
 </div>
 <div class="file-actions">
 <button class="file-btn download-btn">دانلود</button>
 <button class="file-btn delete-btn" onclick="this.closest('.file-item').remove()">حذف</button>
 </div>
 `;

            fileList.appendChild(fileItem);
        }

        function getFileIcon(type) {
            if (type.startsWith('image/')) return '🖼️';
            if (type.startsWith('video/')) return '🎥';
            if (type.startsWith('audio/')) return '🎵';
            if (type.includes('pdf')) return '📄';
            if (type.includes('word')) return '📝';
            if (type.includes('excel')) return '📊';
            return '📁';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // تنظیمات
        function toggleSetting(element) {
            element.classList.toggle('active');
        }

        // مدیریت مودال
        function showExitModal() {
            document.getElementById('exitModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('exitModal').style.display = 'none';
        }

        function endCall() {
            alert('جلسه به پایان رسید. در حال انتقال به داشبورد...');
            // اینجا می‌توانید به صفحه داشبورد منتقل شوید
        }

        // تمام صفحه
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // دسترسی به وب‌کم
        async function initializeMedia() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                document.getElementById('myVideo').srcObject = stream;
            } catch (error) {
                console.error('خطا در دسترسی به وب‌کم:', error);
            }
        }

        // شروع برنامه
        window.onload = function () {
            startTimer();
            initializeMedia();

            // شبیه‌سازی اتصال مشاور بعد از 3 ثانیه
            setTimeout(() => {
                document.querySelector('.video-placeholder').style.display = 'none';
                document.getElementById('participantInfo').style.display = 'flex';
            }, 3000);
        };

        // جلوگیری از بستن صفحه بدون تایید
        window.addEventListener('beforeunload', function (e) {
            e.preventDefault();
            e.returnValue = '';
        });
    </script>
</body>

</html>